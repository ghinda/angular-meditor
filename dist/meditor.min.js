angular.module("angular-meditor",[]).directive("meditor",["$timeout",function(a){"use strict";return{scope:{ngModel:"=",toolbarContainer:"@?"},require:"?ngModel",transclude:!0,templateUrl:"views/editor.html",link:function(b,c,d,e){b.model={ngModel:b.ngModel,showToolbar:!1},b.$watch("model.ngModel",function(){a(function(){b.ngModel=b.model.ngModel})}),b.position={top:10,left:10,below:!1},b.sizeOptions=[{label:"10",value:1},{label:"13",value:2},{label:"16",value:3},{label:"18",value:4},{label:"24",value:5},{label:"32",value:6},{label:"48",value:7}],b.size=b.sizeOptions[0].value,b.familyOptions=[{label:"Open Sans",value:"Open Sans, sans-serif"},{label:"Source Sans Pro",value:"Source Sans Pro, sans-serif"},{label:"Exo",value:"Exo, sans-serif"},{label:"Oswald",value:"Oswald, sans-serif"},{label:"Cardo",value:"Cardo, serif"},{label:"Vollkorn",value:"Vollkorn, serif"},{label:"Old Standard TT",value:"Old Standard TT, serif"}],b.family=b.familyOptions[0],b.styles={};var f={b:"",strong:"",i:"",em:"",u:""},g=function(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}},h=angular.element(c[0].querySelector(".angular-meditor-toolbar")),i=angular.element(c[0].querySelector(".angular-meditor-content")),j=angular.element(c[0].querySelector("select")),k=angular.element(document.querySelector(b.toolbarContainer)||document.body),l=function(){var a=h[0].offsetHeight,c=h[0].offsetWidth,d=5,e=window.getSelection(),f=e.getRangeAt(0),g=f.getBoundingClientRect(),i=g.top,j=g.left;g.top<a+d?(b.position.top=i+g.height+d,b.position.below=!0):(b.position.top=i-a-d,b.position.below=!1),b.position.left=j-c/2+g.width/2;var k=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return b.position.top+=l,b.position.left+=k,this},m=function(d){if(d&&d.target&&h.find(d.target).length)return!1;var e=window.getSelection(),f=e.anchorNode;if(""===e.toString().trim()||!f)return a(function(){b.model.showToolbar=!1});for(var g=f.parentNode;void 0!==g.tagName&&g!==c[0];)g=g.parentNode;return g===c[0]?(a(function(){b.model.showToolbar=!0,l()}),n(e)):a(function(){b.model.showToolbar=!1}),this},n=function(c){var d=c.anchorNode;d.tagName||(d=c.anchorNode.parentNode);var e=d.childNodes[0];e&&e.tagName&&e.tagName.toLowerCase()in f&&(d=d.childNodes[0]),a(function(){b.styles=window.getComputedStyle(d,null),b.styles.fontSize!==b.size.label+"px"&&angular.forEach(b.sizeOptions,function(a,c){return b.styles.fontSize===a.label+"px"?(b.size=b.sizeOptions[c].value,!1):void 0})})};i.bind("keyup",m),document.addEventListener("mouseup",g(m,200)),i.bind("blur",g(m,200)),j.bind("blur",g(m,200)),b.SimpleAction=function(a){document.execCommand("styleWithCSS",!1,!1),document.execCommand(a,!1,null),b.$broadcast("meditor-change")},b.$watch("size",function(){document.execCommand("styleWithCSS",!1,!1),document.execCommand("fontSize",!1,b.size),b.$broadcast("meditor-change")}),b.$watch("family",function(){window.WebFont&&WebFont.load({google:{families:[b.family.label]}}),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontName",!1,b.family.value),b.$broadcast("meditor-change")}),function(){var a=document.createElement("script");a.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),k.append(h)}}}]).directive("meditorContenteditable",["$timeout",function(a){"use strict";return{require:"?ngModel",link:function(b,c,d,e){if("undefined"!=typeof b.ngModel){var f=function(){a(function(){e.$setViewValue(c.html())})};b.$on("meditor-change",f),c.on("blur keyup",f),e.$render=function(){c.html(e.$viewValue)},e.$setViewValue(b.ngModel),c.html(e.$viewValue),b.$watch("ngModel",function(a){c.html()!==a&&c.html(a)})}}}}]),angular.module("angular-meditor").run(["$templateCache",function(a){"use strict";a.put("views/editor.html",'<div class="angular-meditor">\n  <div class="angular-meditor-toolbar" style="top: {{ position.top }}px; left: {{ position.left }}px" ng-class="{ \'angular-meditor-toolbar--show\': model.showToolbar, \'angular-meditor-toolbar--bottom\': position.below }">\n    <ul>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'bold\')" class="meditor-button-bold" ng-class="{ \'bold\': \'meditor-button--active\' }[styles.fontWeight]">\n          B\n        </button>\n      </li>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'italic\')" class="meditor-button-italic" ng-class="{ \'italic\': \'meditor-button--active\' }[styles.fontStyle]">\n          I\n        </button>\n      </li>\n      <li>\n        <button type="button" ng-click="SimpleAction(\'underline\')" class="meditor-button-underline" ng-class="{ \'underline\': \'meditor-button--active\' }[styles.textDecoration]">\n          U\n        </button>\n      </li>\n      <li>\n        <label class="meditor-select">\n          <select ng-model="size" ng-options="s.value as s.label for s in sizeOptions" class="meditor-size-selector"></select>\n        </label>\n      </li>\n      <li>\n        <label class="meditor-select">\n          <select ng-model="family" ng-options="s as s.label for s in familyOptions" class="meditor-family-selector"></select>\n        </label>\n      </li>\n    </ul>\n  </div>\n\n  <div class="angular-meditor-content" contenteditable meditor-contenteditable ng-model="model.ngModel" ng-transclude></div>\n</div>\n')}]);